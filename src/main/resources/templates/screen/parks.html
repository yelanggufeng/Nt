<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
    <title>小微圆总览</title>
    <link rel="stylesheet" th:href="@{/xwyjs/css/all.css}">
    <link rel="stylesheet" th:href="@{/xwyjs/css/particle.css}">
    <link rel="stylesheet" th:href="@{/xwyjs/css/animate.css}">
    <link rel="stylesheet" th:href="@{/xwyjs/css/style_26.css}">
    <link rel="stylesheet" th:href="@{/xwyjs/lib/layui/css/layui.css}">
</head>
<body>
    <div class="R126_wapper">
        <div class="R126_content animated fadeInDownBig" th:object="${overviewBean}">
            <input id="id" name="id" th:value="${parkId}" type="hidden">
            <div id="map"  style="width: 100%;height: 100%;"></div>
            <div class="R126_top_left">
                <div class="R126_top_item">
                    <p>[[${overviewBean.enterPark}]]</p>
                    <span>入园企业</span>
                    <span>(家)</span>
                </div>
                <div class="R126_top_item">
                    <p>[[${overviewBean.enterPerson}]]</p>
                    <span>入园人员</span>
                    <span>(万)</span>
                </div>
                <div class="R126_top_item">
                    <p>[[${overviewBean.income}]]</p>
                    <span>园区收入</span>
                    <span>(亿元)</span>
                </div>
                <div class="R126_top_item">
                    <p>[[${overviewBean.taxRevenue}]]</p>
                    <span>园区税收</span>
                    <span>(亿元)</span>
                </div>
                <div class="R126_top_item">
                    <p>[[${overviewBean.acreIncome}]]</p>
                    <span>亩均收入</span>
                    <span>(亿元)</span>
                </div>
                <div class="R126_top_item">
                    <p>[[${overviewBean.acreTax}]]</p>
                    <span>亩均税收</span>
                    <span>(亿元)</span>
                </div>
            </div>
            <div class="R126_title" style="display: none;">[[${overviewBean.parkName}]]</div>
            <div class="R126_bottom_left">
                <div class="P126_infogGeneral_content">
                    <div class="layui-tab layui-tab-card">
                        <ul class="layui-tab-title">
                            <li class="layui-this">园区概况</li>
                            <li>建设方</li>
                            <li>运营方</li>
                        </ul>
                        <div class="layui-tab-content">
                            <div class="layui-tab-item layui-show" th:text="${#strings.abbreviate(overviewBean.parkDesc,300)}"></div>
                            <div class="layui-tab-item">
                                <li>单位名称：[[${overviewBean.buildUnitName}]]</li>
                                <li>联系人：[[${overviewBean.buildContactName}]]</li>
                                <li>联系电话：[[${overviewBean.buildContactTel}]]</li>
                                <li>联系邮箱：[[${overviewBean.buildContactMail}]]</li>
                            </div>
                            <div class="layui-tab-item">
                                <li>单位名称：[[${overviewBean.operationUnitName}]]</li>
                                <li>联系人：[[${overviewBean.operationContactName}]]</li>
                                <li>联系电话：[[${overviewBean.operationContactTel}]]</li>
                                <li>联系邮箱：[[${overviewBean.operationContactMail}]]</li>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="R126_left_coverage layui-collapse" style="display: none;">
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">图层控制</h2>
                    <div class="layui-colla-content layui-show layui-form">
                        <div class="P210_coverage_item P210_item_icon1">
                            <input type="checkbox" name="" lay-skin="primary" title="视频监控" checked="">
                        </div>
                        <div class="P210_coverage_item P210_item_icon2">
                            <input type="checkbox" name="" lay-skin="primary" title="消防监控">
                        </div>
                        <div class="P210_coverage_item P210_item_icon3">
                            <input type="checkbox" name="" lay-skin="primary" title="车行管理">
                        </div>
                        <div class="P210_coverage_item P210_item_icon4">
                            <input type="checkbox" name="" lay-skin="primary" title="电梯监测">
                        </div>
                        <div class="P210_coverage_item P210_item_icon5">
                            <input type="checkbox" name="" lay-skin="primary" title="安防管理">
                        </div>
                        <div class="P210_coverage_item P210_item_icon6">
                            <input type="checkbox" name="" lay-skin="primary" title="环保监测">
                        </div>
                        <div class="P210_coverage_item P210_item_icon7">
                            <input type="checkbox" name="" lay-skin="primary" title="人行管理">
                        </div>
                        <div class="P210_coverage_item P210_item_icon8">
                            <input type="checkbox" name="" lay-skin="primary" title="能效管理">
                        </div>
                        <div class="P210_coverage_item P210_item_icon9">
                            <input type="checkbox" name="" lay-skin="primary" title="动环监测">
                        </div>
                        <div class="P210_coverage_item P210_item_icon10">
                            <input type="checkbox" name="" lay-skin="primary" title="楼宇自控">
                        </div>
                        <div class="P210_coverage_item P210_item_icon11">
                            <input type="checkbox" name="" lay-skin="primary" title="充电桩管理">
                        </div>
                        <div class="P210_coverage_item P210_item_icon12">
                            <input type="checkbox" name="" lay-skin="primary" title="智能快递柜">
                        </div>
                        <div class="P210_coverage_item P210_item_icon13">
                            <input type="checkbox" name="" lay-skin="primary" title="快递驿站">
                        </div>
                    </div>
                </div>
            </div>
            <div class="R126_top_right">
                <div class="R126_topTitle">企业收入排行</div>
                <div id="R126_incomeChart" style="width: 100%;height: 90%;margin-top: 3%;"></div>
            </div>
            <div class="R126_bottom_right">
                <div class="R126_bottomTitle">企业税收排行</div>
                <div id="R126_taxChart" style="width: 100%;height: 90%;margin-top: 3%;"></div>
            </div>
        </div>
    </div>
</body>

<script src="https://webapi.amap.com/maps?v=1.4.15&key=358df98d6a1422dc83713fddaa8d260c&plugin=AMap.Autocomplete,AMap.PlaceSearch,AMap.Geocoder"></script>
<script th:src="@{/xwyjs/js/jquery.min.js}"></script>
<script th:src="@{/xwyjs/js/main.js}"></script>
<script th:src="@{/xwyjs/js/jquery.backgroundSize.js}"></script>
<script th:src="@{/xwyjs/js/echarts/echarts.js}"></script>
<script th:src="@{/xwyjs/lib/layui/layui.js}"></script>
<script type="text/javascript">
    parent.showReturn()
    var id = $("#id").val();
    var liveView = '[[${overviewBean.liveView}]]'
    if (liveView != '' && liveView != null) {
        document.getElementById('map').style.background = "url(" + liveView + ") no-repeat";
        document.getElementById('map').style.backgroundSize = "cover";
    }else {
        document.getElementById('map').style.background = "url('../../../xwyjs/images/28/W128_kjy.png') no-repeat ";
        document.getElementById('map').style.backgroundSize = "cover";
    }
    $(document).ready(function() {
        var title = '[[${overviewBean.parkName}]]'
        parent.changeTitle(title)

        layui.use(['element', 'form'], function() {
            var $ = layui.jquery
                , element = layui.element //Tab的切换功能，切换事件监听等，需要依赖element模块
                , form = layui.form

            form.on('checkbox()', function(data) {
                // var index = pointsName.indexOf(data.elem.title)
                // if (data.elem.checked) {
                //     points[index] = pointsTest[index]
                //     addMakers(points[index], index)
                // } else {
                //     removeMakers(index)
                //     points[index] = null
                // }
            })
        })
    })

    var points = [null, null, null, null, null, null, null, null, null, null, null, null, null]
    var markers = [
        [

        ],
        [

        ],
        [

        ]
    ]
    // 模拟数据
    var pointsTest = [
        [
            {
                lat: 28.88899,
                lon: 120.047356,
            },
            {
                lat: 28.88899,
                lon: 120.017156,
            },
            {
                lat: 28.88822,
                lon: 120.047356,
            },
        ],
        [
            {
                lat: 28.91957,
                lon: 119.97322,
            }
        ],
        [
            {
                lat: 28.90991,
                lon: 119.96417,
            }
        ],
        [
            {
                lat: 28.98404,
                lon: 120.07781,
            }
        ],
        [
            {
                lat: 29.02307,
                lon: 120.1209,
            }
        ],
        [
            {
                lat: 28.91426,
                lon: 120.03782,
            }
        ],
        [
            {
                lat: 28.89555,
                lon: 120.03696,
            }
        ],
        [
            {
                lat: 28.88939,
                lon: 120.03112,
            }
        ],
        [
            {
                lat: 28.94134,
                lon: 120.13687,
            }
        ],
        [
            {
                lat: 28.9383,
                lon: 120.14078,
            }
        ],
        [
            {
                lat: 28.94367,
                lon: 120.1409,
            }
        ],
        [
            {
                lat: 28.91811,
                lon: 119.97051,
            }],
        [
            {
                lat: 28.92034,
                lon: 119.97035,
            }]
    ]
    var pointsName = [
        '视频监控',
        '消防监控',
        '车行管理',
        '电梯监测',
        '安防管理',
        '环保监测',
        '人行管理',
        '能效管理',
        '动环监测',
        '楼宇自控',
        '充电桩管理',
        '智能快递柜',
        '快递驿站']
    // var map = new AMap.Map('map', {
    //     resizeEnable: true, // 是否监控地图容器尺寸变化
    //     dragEnable: true, // 地图是否可通过鼠标拖拽平移，默认为true
    //     keyboardEnable: true, // 地图是否可通过键盘控制，默认为true
    //     doubleClickZoom: true, // 地图是否可通过双击鼠标放大地图，默认为true
    //     center:[120.047356,28.88899],
    //     mapStyle: 'amap://styles/blue',
    //     zoom: 15
    // })
    // 页面打开时默认选中第一个(即视频监控)
    points[0] = pointsTest[0]
    // addMakers(points[0], 0)

    /**
     * 添加单个点
     * @param data 数据源
     * @return {AMap.Marker}
     */
    function addMaker(data, index) {
        var marker = new AMap.Marker({
            position: new AMap.LngLat(parseFloat(data.lon), parseFloat(data.lat)),
            offset: new AMap.Pixel(-13, -45),
            content: `<div class="P210_mapIcon"><img src="../../../xwyjs/images/10/P210_coverage_icon` + (index + 1) +
                `-1.png"></div>`
        })
        return marker
    }

    /**
     * 加标记点
     */
    function addMakers(pointsList, index) {
        for (var i = 0; i < pointsList.length; i++) {
            markers[index].push(addMaker(pointsList[i], index))
        }
        map.add(markers[index])
    }

    /**
     * 删除标记点
     * @param data 数据源
     * @return {AMap.Marker}
     */
    function removeMakers(index) {
        map.remove(markers[index])
    }

    function eChartInit(el, data) {
        var info = []
        var option = {
            title: {
                show: false
            },
            grid: {
                left: '20%',
                top: '2.5%',
                right: '24%',
                bottom: '0%',
                containLabel: true
            },
            xAxis: [
                {
                    show: false,
                },
                //由于下边X轴已经是百分比刻度了,所以需要在顶部加一个X轴,刻度是金额,也隐藏掉
                {
                    show: false,
                }
            ],
            yAxis: {
                type: 'category',
                axisLabel: {
                    show: false, //让Y轴数据不显示
                },
                itemStyle: {},
                axisTick: {
                    show: false, //隐藏Y轴刻度
                },
                axisLine: {
                    show: false, //隐藏Y轴线段
                },
                inverse: true,
                data: [],
            },
            series: [
                //背景色--------------------我是分割线君------------------------------//
                {
                    show: true,
                    type: 'bar',
                    barWidth: '12',
                    barGap: '-100%',
                    silent: true,
                    itemStyle: {
                        normal: {
                            borderWidth: 0,
                            color: 'transparent',
                        }
                    },
                    label: {
                        normal: {
                            show: true,
                            position: ['105%', '-5'],
                            formatter: function(data) {
                                return '{b|' + info[data.dataIndex] + '}{a|' + '万' + '}'
                            },
                            rich: {
                                a:{
                                    fontSize: '14',
                                    color: '#00C6FF'
                                },
                                b:{
                                    fontSize: '18',
                                    color: '#00C6FF'
                                }
                            }
                        }
                    },
                    z: 1,
                    data: [],
                },
                //蓝条--------------------我是分割线君------------------------------//
                {
                    show: true,
                    type: 'bar',
                    barWidth: '12',
                    itemStyle: {
                        normal: {
                            barBorderRadius: [0,50,50,0],
                            color: (params) => {
                                if (params.dataIndex === 0) {
                                    return new echarts.graphic.LinearGradient(0, 0, 1, 0, [
                                        {
                                            offset: 0,
                                            color: '#FF4B4B' // 0% 处的颜色
                                        }, {
                                            offset: 1,
                                            color: '#FF9393' // 100% 处的颜色
                                        }], false)
                                } else if (params.dataIndex === 1) {
                                    return new echarts.graphic.LinearGradient(0, 0, 1, 0, [
                                        {
                                            offset: 0,
                                            color: '#0FC06D' // 0% 处的颜色
                                        }, {
                                            offset: 1,
                                            color: '#72F5C7' // 100% 处的颜色
                                        }], false)
                                } else if (params.dataIndex === 2) {
                                    return new echarts.graphic.LinearGradient(0, 0, 1, 0, [
                                        {
                                            offset: 0,
                                            color: '#FF9A08' // 0% 处的颜色
                                        }, {
                                            offset: 1,
                                            color: '#FFD734' // 100% 处的颜色
                                        }], false)
                                } else {
                                    return new echarts.graphic.LinearGradient(0, 0, 1, 0, [
                                        {
                                            offset: 0,
                                            color: '#2A63FF' // 0% 处的颜色
                                        }, {
                                            offset: 1,
                                            color: '#4AE1FC' // 100% 处的颜色
                                        }], false)
                                }
                            },
                        },
                    },
                    label: {
                        normal: {
                            show: false,
                            textStyle: {
                                color: '#4a505f',
                                fontSize: '16'
                            },
                        }
                    },
                    labelLine: {
                        show: false,
                    },
                    z: 2,
                    data: [],
                },
                //数据条--------------------我是分割线君------------------------------//
                {
                    show: true,
                    type: 'bar',
                    xAxisIndex: 1, //代表使用第二个X轴刻度!!!!!!!!!!!!!!!!!!!!!!!!
                    barGap: '-100%',
                    barWidth: '12', //统计条宽度
                    itemStyle: {
                        normal: {
                            barBorderRadius: 200,
                            color: 'rgba(22,203,115,0.05)'
                        },
                    },
                    label: {
                        normal: {
                            show: true,
                            position: ['-60', '-20'],
                            rich: {
                                a1: {
                                    width: 60,
                                    color: '#ff9e0a',
                                    align: 'left',
                                    fontSize: 16,
                                    fontStyle: 'italic',
                                    fontWeight: 'bold'
                                },
                                a2: {
                                    width: 60,
                                    color: '#06e07c',
                                    align: 'left',
                                    fontSize: 16,
                                    fontStyle: 'italic',
                                    fontWeight: 'bold'
                                },
                                a3: {
                                    width: 60,
                                    color: '#ff8484',
                                    align: 'left',
                                    fontSize: 16,
                                    fontStyle: 'italic',
                                    fontWeight: 'bold'
                                },
                                b: {
                                    width: 60,
                                    color: '#3296f4',
                                    align: 'left',
                                    fontSize: 16,
                                    fontStyle: 'italic',
                                    fontWeight: 'bold'
                                },
                                c: {
                                    color: '#00BFF7',
                                    align: 'left',
                                    fontSize: 14
                                }
                            },
                            formatter: function(data) {
                                if (data.dataIndex < 3) {
                                    return [
                                        '{a' + (data.dataIndex + 1) + '|NO.' + (data.dataIndex + 1) + '}' + '{c|' + data.name + '}'
                                    ].join('\n')
                                } else {
                                    return [
                                        '{b|NO.' + (data.dataIndex + 1) + '}' + '{c|' + data.name + '}'
                                    ].join('\n')
                                }
                            }
                        }
                    },
                    data: []
                }
            ]
        }
        for (var i = 0; i < data.length; i++) {
            info.push(data[i].amount)
            option.yAxis.data.push(data[i].name)
            option.series[0].data.push(data[0].amount)
            option.series[1].data.push(data[i].amount)
            option.series[2].data.push(data[i].amount)
        }
        var newCahrt = echarts.init(el)
        newCahrt.setOption(option)
        $(window).resize(function() {
            newCahrt.resize()
        })
    }

    var dom1 = document.getElementById('R126_taxChart')
    $.ajax({
        cache: true,
        contentType: "application/json",
        dataType: "json",
        type: "GET",
        url: "/index/tax/rank/"+id,
        async: false,
        error: function (request) {
            $.modal.alertError("系统错误");
        },
        success: function (data) {
            eChartInit(dom1, data)
        }
    });

    var category = [];
    $.ajax({
        cache: true,
        contentType: "application/json",
        dataType: "json",
        type: "GET",
        url: "/index/income/rank/"+id,
        async: false,
        error: function (request) {
            $.modal.alertError("系统错误");
        },
        success: function (data) {
            for(var i = 0; i < data.length; i++) {
                var obj = {value:'',name:''}
                obj.value = data[i].amount
                obj.name =  data[i].name
                category.push(obj)
            }
        }
    });


    // 类别
    var option = {
        xAxis: {
            splitLine: {
                show: false
            },
            axisLine: {
                show: false
            },
            axisLabel: {
                show: false
            },
            axisTick: {
                show: false
            }
        },
        grid: {
            left: '22%',
            top: '5%',
            right: '10%',
            bottom: '0%',
            containLabel: true
        },
        yAxis: [{
            type: "category",
            inverse: true,
            data: category,
            axisLine: {
                show: false
            },
            axisTick: {
                show: false
            },
            axisLabel: {
                show: false,
            }
        },
        {
            type: "category",
            inverse: true,
            data: category,
            axisLine: {
                show: false
            },
            axisTick: {
                show: false
            },
            axisLabel: {
                show: true,
                formatter: function (params) {
                    return '{a|'+ params + '}{b|'+ '万' + '}'
                },
                rich: {
                    a:{
                        color: '#00C4FD',
                        fontSize: 18
                    },
                    b:{
                        color: '#00C4FD',
                        fontSize: 14
                    }
                }
            }
        }],
        series: [{
            // 内
            type: "bar",
            barWidth: 12,
            legendHoverLink: false,
            silent: true,
            itemStyle: {
                normal: {
                    color: function(params) {
                        var color;
                        if(params.dataIndex == 0){
                            color = {
                                type: "linear",x: 0,y: 0,x2: 1,y2: 0,
                                colorStops: [{
                                    offset: 0,
                                    color: "#15264A" // 0% 处的颜色
                                },
                                {
                                    offset: 1,
                                    color: "#CD343B" // 100% 处的颜色
                                }
                                ]
                            }
                        }else if(params.dataIndex == 1){
                            color = {
                                type: "linear",x: 0,y: 0,x2: 1,y2: 0,
                                colorStops: [{
                                    offset: 0,
                                    color: "#1C2D4A" // 0% 处的颜色
                                },
                                {
                                    offset: 1,
                                    color: "#CD531C" // 100% 处的颜色
                                }
                                ]
                            }
                        }else if(params.dataIndex == 2){
                            color = {
                                type: "linear",x: 0,y: 0,x2: 1,y2: 0,
                                colorStops: [{
                                    offset: 0,
                                    color: "#102D46" // 0% 处的颜色
                                },
                                {
                                    offset: 1,
                                    color: "#148314" // 100% 处的颜色
                                }
                                ]
                            }
                        }else{
                            color = {
                                type: "linear",x: 0,y: 0,x2: 1,y2: 0,
                                colorStops: [{
                                    offset: 0,
                                    color: "#0D294F" // 0% 处的颜色
                                },
                                {
                                    offset: 1,
                                    color: "#5258CF" // 100% 处的颜色
                                }
                                ]
                            }
                        }
                        return color;
                    },
                }
            },
            label: {
                normal: {
                    show: true,
                    position: ['-60', '-20'],
                    rich: {
                        a1: {
                            width: 60,
                            color: '#ff9e0a',
                            align: 'left',
                            fontSize: 16,
                            fontStyle: 'italic',
                            fontWeight: 'bold'
                        },
                        a2: {
                            width: 60,
                            color: '#06e07c',
                            align: 'left',
                            fontSize: 16,
                            fontStyle: 'italic',
                            fontWeight: 'bold'
                        },
                        a3: {
                            width: 60,
                            color: '#ff8484',
                            align: 'left',
                            fontSize: 16,
                            fontStyle: 'italic',
                            fontWeight: 'bold'
                        },
                        b: {
                            width: 60,
                            color: '#3296f4',
                            align: 'left',
                            fontSize: 16,
                            fontStyle: 'italic',
                            fontWeight: 'bold'
                        },
                        c: {
                            color: '#00BFF7',
                            align: 'left',
                            fontSize: 14
                        }
                    },
                    formatter: function(data) {
                        if (data.dataIndex < 3) {
                            return [
                                '{a' + (data.dataIndex + 1) + '|NO.' + (data.dataIndex + 1) + '}' + '{c|' + data.name + '}'
                            ].join('\n')
                        } else {
                            return [
                                '{b|NO.' + (data.dataIndex + 1) + '}' + '{c|' + data.name + '}'
                            ].join('\n')
                        }
                    }
                }
            },
            data: category,
            z: 1,
            animationEasing: "elasticOut"
        },
            {
                // 分隔
                type: "pictorialBar",
                itemStyle: {
                    normal:{
                        color:"#071F45"
                    }
                },
                symbolRepeat: "fixed",
                symbolMargin: 3,
                symbol: "rect",
                symbolClip: true,
                symbolSize: [5, 15],
                symbolPosition: "start",
                symbolOffset: [1, 0],
                data: category,
                z: 2,
                animationEasing: "elasticOut"
            }
        ]
    }
    var mychart = echarts.init(document.getElementById('R126_incomeChart'))
    mychart.setOption(option)

    window.addEventListener('resize', function() {
        mychart.resize()
    })
</script>
</html>
