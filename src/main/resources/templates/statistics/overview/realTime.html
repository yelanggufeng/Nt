<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
    <title>永康市数字小微园政府监管应用</title>
    <link rel="stylesheet" th:href="@{/xwyjs/css/all.css}">
    <link rel="stylesheet" th:href="@{/xwyjs/css/style_10.css}">
    <link rel="stylesheet" th:href="@{/xwyjs/lib/layui/css/layui.css}">
    <style>
        html {
            overflow-x: hidden;
            overflow-y: auto;
        }
    </style>
</head>
<body>
<div class="R110_wrapper">
    <div class="R110_up">
        园区总览>实时报警
    </div>
    <div class="R110_content">
        <div class="R110_container">
            <div class="R110_mapOuter" id="realtime_container"></div>
            <div class="R110_total clear">
                <div class="R110_totalItem fl">
                    <div class="R110_totalNumber"><span>3</span></div>
                    <div class="R110_totalText"><span>消防检测报警总数</span></div>
                </div>
                <div class="R110_totalItem fl">
                    <div class="R110_totalNumber"><span>11</span></div>
                    <div class="R110_totalText"><span>动环监测报警总数</span></div>
                </div>
                <div class="R110_totalItem fl">
                    <div class="R110_totalNumber"><span>4</span></div>
                    <div class="R110_totalText"><span>电梯监测报警总数</span></div>
                </div>
                <div class="R110_totalItem fl">
                    <div class="R110_totalNumber"><span>2</span></div>
                    <div class="R110_totalText"><span>安防管理报警数</span></div>
                </div>
                <div class="R110_totalItem fl">
                    <div class="R110_totalNumber"><span>11</span></div>
                    <div class="R110_totalText"><span>环保检测报警总数</span></div>
                </div>
                <div class="R110_totalItem fl">
                    <div class="R110_totalNumber"><span>9</span></div>
                    <div class="R110_totalText"><span>人行管理报警总数</span></div>
                </div>
                <div class="R110_totalItem fl">
                    <div class="R110_totalNumber"><span>8</span></div>
                    <div class="R110_totalText"><span>能效管理报警总数</span></div>
                </div>
                <div class="R110_totalItem fl">
                    <div class="R110_totalNumber"><span>11</span></div>
                    <div class="R110_totalText"><span>楼宇自控报警总数</span></div>
                </div>
                <div class="R110_totalItem fl">
                    <div class="R110_totalNumber"><span>8</span></div>
                    <div class="R110_totalText"><span>充电桩报警总数</span></div>
                </div>
                <div class="R110_totalItem fl">
                    <div class="R110_totalNumber"><span>3</span></div>
                    <div class="R110_totalText"><span>智能快递报警总数</span></div>
                </div>
            </div>
<!--            <div class="R110_feature clear">-->
<!--                <div class="R110_featureItem featureItem_icon1 fl">-->
<!--                    <img th:src="@{/xwyjs/images/10/R110_featureIcon1.png}" alt="">-->
<!--                    <span>图例</span>-->
<!--                </div>-->
<!--                <div class="R110_featureItem featureItem_icon2 fl">-->
<!--                    <img th:src="@{/xwyjs/images/10/R110_featureIcon2.png}" alt="">-->
<!--                    <span>图层</span>-->
<!--                </div>-->
<!--                <div class="R110_featureItem featureItem_icon3 fl">-->
<!--                    <img th:src="@{/xwyjs/images/10/R110_featureIcon3.png}" alt="">-->
<!--                    <span>搜索</span>-->
<!--                </div>-->
<!--            </div>-->
            <div class="R110_left_coverage layui-collapse fl">
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">图层控制</h2>
                    <div class="layui-colla-content layui-show layui-form">
                        <div class="R110_coverage_item R110_item_icon1">
                            <input type="checkbox" name="" lay-skin="primary" title="视频监控" checked="">
                        </div>
                        <div class="R110_coverage_item R110_item_icon2">
                            <input type="checkbox" name="" lay-skin="primary" title="消防监控">
                        </div>
                        <div class="R110_coverage_item R110_item_icon3">
                            <input type="checkbox" name="" lay-skin="primary" title="车行管理">
                        </div>
                        <div class="R110_coverage_item R110_item_icon4">
                            <input type="checkbox" name="" lay-skin="primary" title="电梯监测">
                        </div>
                        <div class="R110_coverage_item R110_item_icon5">
                            <input type="checkbox" name="" lay-skin="primary" title="安防管理">
                        </div>
                        <div class="R110_coverage_item R110_item_icon6">
                            <input type="checkbox" name="" lay-skin="primary" title="环保监测">
                        </div>
                        <div class="R110_coverage_item R110_item_icon7">
                            <input type="checkbox" name="" lay-skin="primary" title="人行管理">
                        </div>
                        <div class="R110_coverage_item R110_item_icon8">
                            <input type="checkbox" name="" lay-skin="primary" title="能效管理">
                        </div>
                        <div class="R110_coverage_item R110_item_icon9">
                            <input type="checkbox" name="" lay-skin="primary" title="动环监测">
                        </div>
                        <div class="R110_coverage_item R110_item_icon10">
                            <input type="checkbox" name="" lay-skin="primary" title="楼宇自控">
                        </div>
                        <div class="R110_coverage_item R110_item_icon11">
                            <input type="checkbox" name="" lay-skin="primary" title="充电桩管理">
                        </div>
                        <div class="R110_coverage_item R110_item_icon12">
                            <input type="checkbox" name="" lay-skin="primary" title="智能快递柜">
                        </div>
                        <div class="R110_coverage_item R110_item_icon13">
                            <input type="checkbox" name="" lay-skin="primary" title="快递驿站">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="//webapi.amap.com/maps?v=1.4.15&key=358df98d6a1422dc83713fddaa8d260c&plugin=AMap.DistrictSearch"></script>
<script th:src="@{/xwyjs/js/jquery.min.js}"></script>
<script th:src="@{/xwyjs/js/main.js}"></script>
<script th:src="@{/xwyjs/js/27/jquery.backgroundSize.js}"></script>
<script th:src="@{/xwyjs/js/echarts/echarts.js}"></script>
<script th:src="@{/xwyjs/lib/layui/layui.js}"></script>
<script>
    var points = [null, null, null, null, null, null, null, null, null, null, null, null, null]
    var markers = [
        [
        ],
        [
        ],
        [
        ]
    ]
    // 模拟数据
    var pointsTest = [
        [
            {
                lat: 28.92034,
                lon: 119.97035,
            }
        ],
        [
            {
                lat: 28.91957,
                lon: 119.97322,
            }
        ],
        [
            {
                lat: 28.90991,
                lon: 119.96417,
            }
        ],
        [
            {
                lat: 28.98404,
                lon: 120.07781,
            }
        ],
        [
            {
                lat: 29.02307,
                lon: 120.1209,
            }
        ],
        [
            {
                lat: 28.91426,
                lon: 120.03782,
            }
        ],
        [
            {
                lat: 28.89555,
                lon: 120.03696,
            }
        ],
        [
            {
                lat: 28.88939,
                lon: 120.03112,
            }
        ],
        [
            {
                lat: 28.94134,
                lon: 120.13687,
            }
        ],
        [
            {
                lat: 28.9383,
                lon: 120.14078,
            }
        ],
        [
            {
                lat: 28.94367,
                lon: 120.1409,
            }
        ],
        [
            {
                lat: 28.91811,
                lon: 119.97051,
            }],
        [
            {
                lat: 28.92034,
                lon: 119.97035,
            }]
    ]
    var pointsName = [
        '视频监控',
        '消防监控',
        '车行管理',
        '电梯监测',
        '安防管理',
        '环保监测',
        '人行管理',
        '能效管理',
        '动环监测',
        '楼宇自控',
        '充电桩管理',
        '智能快递柜',
        '快递驿站']
    var map = new AMap.Map('realtime_container', {
        resizeEnable: true, // 是否监控地图容器尺寸变化
        zoom: 10, // 初始化地图层级
        dragEnable: true, // 地图是否可通过鼠标拖拽平移，默认为true
        keyboardEnable: true, // 地图是否可通过键盘控制，默认为true
        doubleClickZoom: true, // 地图是否可通过双击鼠标放大地图，默认为true
        center: [120.04731, 28.88851], // 中心点坐标
    })
    var district = null
    var polygons = []

    function drawBounds() {
        //加载行政区划插件
        if (!district) {
            //实例化DistrictSearch
            var opts = {
                subdistrict: 0,   //获取边界不需要返回下级行政区
                extensions: 'all',  //返回行政区边界坐标组等具体信息
                level: 'district'  //查询行政级别为 市
            }
            district = new AMap.DistrictSearch(opts)
        }
        district.search('永康市', function (status, result) {
            map.remove(polygons) // 清除上次结果
            polygons = []
            var bounds = result.districtList[0].boundaries
            if (bounds) {
                for (var i = 0, l = bounds.length; i < l; i++) {
                    // 生成行政区划polygon
                    var polygon = new AMap.Polygon({
                        strokeWeight: 2,
                        strokeStyle: 'dashed',
                        path: bounds[i],
                        fillOpacity: 0.6,
                        fillColor: '#d7e2f4',
                        strokeColor: '#6395fc'
                    })
                    polygons.push(polygon)
                }
            }
            map.add(polygons)
            map.setFitView(polygons, true, [20, 20, 20, 20], 12) // 视口自适应
        })
    }

    drawBounds()
    // 页面打开时默认选中第一个(即视频监控)
    points[0] = pointsTest[0]
    addMakers(points[0], 0)

    /**
     * 添加单个点
     * @param data 数据源
     * @return {AMap.Marker}
     */
    function addMaker(data, index) {
        var marker = new AMap.Marker({
            position: new AMap.LngLat(parseFloat(data.lon), parseFloat(data.lat)),
            offset: new AMap.Pixel(-13, -45),
            content: `<div class="P210_mapIcon"><img src="../../../xwyjs/images/10/P210_coverage_icon` + (index + 1) +
                `-1.png"></div>`
        })
        return marker
    }

    /**
     * 加标记点
     */
    function addMakers(pointsList, index) {
        for (var i = 0; i < pointsList.length; i++) {
            markers[index].push(addMaker(pointsList[i], index))
        }
        map.add(markers[index])
    }

    /**
     * 删除标记点
     * @param data 数据源
     * @return {AMap.Marker}
     */
    function removeMakers(index) {
        map.remove(markers[index])
    }

    layui.use(['element', 'form'], function () {
        var $ = layui.jquery
            , element = layui.element //Tab的切换功能，切换事件监听等，需要依赖element模块
            , form = layui.form

        form.on('checkbox()', function (data) {
            var index = pointsName.indexOf(data.elem.title)
            if (data.elem.checked) {
                points[index] = pointsTest[index]
                addMakers(points[index], index)
            } else {
                removeMakers(index)
                points[index] = null
            }
        })
    })
</script>
</body>
</html>
