<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
    <title>总览</title>
    <link rel="stylesheet" th:href="@{/xwyjs/css/all.css}">
    <link rel="stylesheet" th:href="@{/xwyjs/css/style_06.css}">
    <link rel="stylesheet" th:href="@{/xwyjs/css/style_27.css}">
    <link rel="stylesheet" th:href="@{/xwyjs/lib/layui/css/layui.css}">

    <style>
        html {
            overflow-x: hidden;
            overflow-y: auto;
        }

        .J106_up {
            display: flex;
            justify-content: space-between;
        }

        .J106_up_right {
            background: #2a7bf2;
            padding: 0 10px;
            border-radius: 5px;
            text-align: center;
            height: 26px;
            line-height: 26px;
            color: #fff;
            cursor: pointer;
            position: relative;
            top: -5px;
        }
        .fullscreen {
            position: absolute;
            right: 10px;
            top: 1%;
        }
        .fullscreen img {
            width: 32px;
            height: 32px;
        }
        .Z106_zhhzName{
            overflow:hidden;
            text-overflow:ellipsis;
            white-space:nowrap;
        }
        .Z106_xwyOuter{
            height: 15%;
        }
        .Z106_xwyItem{
            width: 100%;
            height: 100%;
        }
        .Z106_xwy{
            padding: 1% 0 0 0;
        }
        .P126_carouselItem{
            width: 31%;
            float: left;
            margin-left: 2%;
            height: 45%;
        }
    </style>
</head>
<body>
<div class="J106_wrapper">
    <div class="J106_up">
        <div class="J106_up_left">园区总览>总览</div>
        <div class="J106_up_right">
            <span class="hide">隐藏图层</span>
            <span class="show" style="display:none;">显示图层</span>
        </div>
    </div>
    <div class="J106_content">
        <div class="Z106_container">
            <div class="Z106_mapOuter" id="mapContainer"></div>
            <!--<div class="Z106_mapTips">-->
            <!--<div class="Z106_mapTip">-->
            <!--<img th:src="@{/xwyjs/images/06/Z106_icon10.png}" alt="">-->
            <!--<span>拟建</span>-->
            <!--</div>-->
            <!--<div class="Z106_mapTip">-->
            <!--<img th:src="@{/xwyjs/images/06/Z106_icon11.png}" alt="">-->
            <!--<span>开工</span>-->
            <!--</div>-->
            <!--<div class="Z106_mapTip">-->
            <!--<img th:src="@{/xwyjs/images/06/Z106_icon12.png}" alt="">-->
            <!--<span>运营</span>-->
            <!--</div>-->
            <!--<div class="Z106_mapTip">-->
            <!--<img th:src="@{/xwyjs/images/06/Z106_icon13.png}" alt="">-->
            <!--<span>挂牌中</span>-->
            <!--</div>-->
            <!--</div>-->
            <!--全屏-->
            <div class="fullscreen">
                <img th:src="@{/xwyjs/images/06/fullscreen.png}" class="img1">
            </div>
            <!--综合汇总start-->
            <div class="Z106_item Z106_zhhz">
                <div class="Z106_itemTop clear">
                    <div class="Z106_itemTitle">综合汇总</div>
                </div>
                <div class="Z106_itemContent">
                    <div class="Z106_zhhzTableOuter">
                        <table class="Z106_zhhzTable" th:object="${bean}">
                            <tr>
                                <td>
                                    <div class="Z106_zhhzIconOuter">
                                        <img th:src="@{/xwyjs/images/06/Z106_icon1.png}" alt="" class="Z106_zhhzIcon">
                                    </div>
                                    <div class="Z106_zhhzInfo">
                                        <div class="Z106_zhhzName">镇/街道（个）</div>
                                        <div class="Z106_zhhzNumber">8</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="Z106_zhhzIconOuter">
                                        <img th:src="@{/xwyjs/images/06/Z106_icon2.png}" alt="" class="Z106_zhhzIcon">
                                    </div>
                                    <div class="Z106_zhhzInfo">
                                        <div class="Z106_zhhzName">社区/行政村（个）</div>
                                        <div class="Z106_zhhzNumber">25</div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="Z106_zhhzIconOuter">
                                        <img th:src="@{/xwyjs/images/06/Z106_icon3.png}" alt="" class="Z106_zhhzIcon">
                                    </div>
                                    <div class="Z106_zhhzInfo">
                                        <div class="Z106_zhhzName">建筑面积（万平方米）</div>
                                        <div class="Z106_zhhzNumber">
                                            <span class="A124_balance_num"
                                                  th:text="${#numbers.formatDecimal(bean.bulidArea,1,2,'POINT')}"></span>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="Z106_zhhzIconOuter">
                                        <img th:src="@{/xwyjs/images/06/Z106_icon4.png}" alt="" class="Z106_zhhzIcon">
                                    </div>
                                    <div class="Z106_zhhzInfo">
                                        <div class="Z106_zhhzName">占地面积（亩）</div>
                                        <div class="Z106_zhhzNumber">
                                            <span class="A124_balance_num"
                                                  th:text="${#numbers.formatDecimal(bean.coverdArea,1,0,'POINT')}"></span>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="Z106_zhhzIconOuter">
                                        <img th:src="@{/xwyjs/images/06/Z106_icon5.png}" alt="" class="Z106_zhhzIcon">
                                    </div>
                                    <div class="Z106_zhhzInfo">
                                        <div class="Z106_zhhzName">入园企业（家）</div>
                                        <div class="Z106_zhhzNumber">[[${bean.enterPark}]]</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="Z106_zhhzIconOuter">
                                        <img th:src="@{/xwyjs/images/06/Z106_icon6.png}" alt="" class="Z106_zhhzIcon">
                                    </div>
                                    <div class="Z106_zhhzInfo">
                                        <div class="Z106_zhhzName">入园人员（万）</div>
                                        <div class="Z106_zhhzNumber">
                                            <span class="A124_balance_num">[[${bean.enterPerson}]]</span>
                                        </div>

                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="Z106_zhhzIconOuter">
                                        <img th:src="@{/xwyjs/images/06/Z106_icon7.png}" alt="" class="Z106_zhhzIcon">
                                    </div>
                                    <div class="Z106_zhhzInfo">
                                        <div class="Z106_zhhzName">园区收入(亿元)</div>
                                        <div class="Z106_zhhzNumber">[[${bean.income}]]</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="Z106_zhhzIconOuter">
                                        <img th:src="@{/xwyjs/images/06/Z106_icon8.png}" alt="" class="Z106_zhhzIcon">
                                    </div>
                                    <div class="Z106_zhhzInfo">
                                        <div class="Z106_zhhzName">园区税收(亿元)</div>
                                        <div class="Z106_zhhzNumber">[[${bean.taxRevenue}]]</div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <!--综合汇总end-->
            <!--入园企业趋势start-->
            <div class="Z106_item Z106_ryqyqs">
                <div class="Z106_itemTop clear">
                    <div class="Z106_itemTitle">入园企业趋势</div>
                </div>
                <div class="Z106_itemContent">
                    <div class="Z106_ryqyqsCharts" id="ryqyqsCharts"></div>
                </div>
            </div>
            <!--入园企业趋势end-->
            <!--数量start-->
            <div class="Z106_total clear" th:object="${bean}">
                <div class="Z106_totalItem">
                    <div class="Z106_totalNumber">
                        <img th:src="@{/xwyjs/images/06/Z106_bg1.png}" alt="" class="J106_imgBg">
                        <span>[[${bean.sumCount}]]</span>
                    </div>
                    <div class="Z106_totalName">总数</div>
                </div>
                <div class="Z106_totalItem">
                    <div class="Z106_totalNumber">
                        <img th:src="@{/xwyjs/images/06/Z106_bg2.png}" alt="" class="J106_imgBg">
                        <span>[[${bean.proposed}]]</span>
                    </div>
                    <div class="Z106_totalName">拟建</div>
                </div>
                <div class="Z106_totalItem">
                    <div class="Z106_totalNumber">
                        <img th:src="@{/xwyjs/images/06/Z106_bg3.png}" alt="" class="J106_imgBg">
                        <span>[[${bean.start}]]</span>
                    </div>
                    <div class="Z106_totalName">开工</div>
                </div>
                <div class="Z106_totalItem">
                    <div class="Z106_totalNumber">
                        <img th:src="@{/xwyjs/images/06/Z106_bg4.png}" alt="" class="J106_imgBg">
                        <span>[[${bean.operate}]]</span>
                    </div>
                    <div class="Z106_totalName">运营</div>
                </div>
                <div class="Z106_totalItem">
                    <div class="Z106_totalNumber">
                        <img th:src="@{/xwyjs/images/06/Z106_bg5.png}" alt="" class="J106_imgBg">
                        <span>[[${bean.listing}]]</span>
                    </div>
                    <div class="Z106_totalName">挂牌中</div>
                </div>
            </div>
            <!--数量end-->
            <!--小微园start-->
            <div class="Z106_xwyOuter">
                <div class="Z106_xwy clear">
                    <div class="Z106_xwyItem layui-carousel" id="test">
                        <div carousel-item >
                            <div th:each="mapEntry: ${map}">
                                <div class="P126_carouselItem" th:each="bean: ${mapEntry.value}">
                                    <div class="Z106_xwyItemIcon">
                                        <img th:if="${bean.level > 0}" th:src="@{/xwyjs/images/06/Z106_icon9.png}" />
                                        <img th:if="${bean.level > 1}" th:src="@{/xwyjs/images/06/Z106_icon9.png}" />
                                        <img th:if="${bean.level > 2}" th:src="@{/xwyjs/images/06/Z106_icon9.png}" />
                                        <img th:if="${bean.level > 3}" th:src="@{/xwyjs/images/06/Z106_icon9.png}" />
                                        <img th:if="${bean.level > 4}" th:src="@{/xwyjs/images/06/Z106_icon9.png}" />
                                    </div>
                                    <a th:href="@{/statistics/eachpark/dimension/{id}(id=${bean.id})}">
                                        <div  class="Z106_xwyItemName" th:text="${#strings.abbreviate(bean.name,13)}"></div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--小微园end-->
        </div>
    </div>
</div>

<script src="https://webapi.amap.com/maps?v=1.4.10&key=358df98d6a1422dc83713fddaa8d260c&plugin=AMap.Geocoder&plugin=AMap.MarkerClusterer&plugin=AMap.DistrictSearch">
</script>
<script th:src="@{/xwyjs/js/jquery.min.js}"></script>
<script th:src="@{/xwyjs/js/main.js}"></script>
<script th:src="@{/xwyjs/js/jquery.backgroundSize.js}"></script>
<script th:src="@{/xwyjs/js/echarts/echarts.js}"></script>
<script th:src="@{/xwyjs/lib/layui/layui.js}"></script>
<script>
    $(document).ready(function () {
        // 入园企业趋势
        function ryqyqsChartsInit(el, data) {
            var dates = []
            var vaules = []

            if (data) {
                for (var i = 0; i < data.length; i++) {
                    dates.push(data[i].year)
                    vaules.push(data[i].count)
                }
            }
            var option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    top: '10%',
                    right: '5%',
                    left: '15%',
                    bottom: '15%'
                },
                xAxis: [{
                    type: 'category',
                    data: dates,
                    axisLine: {
                        lineStyle: {
                            color: '#eef3f8'
                        }
                    },
                    axisLabel: {
                        margin: 10,
                        color: '#666666',
                        textStyle: {
                            fontSize: 12
                        },
                        interval: 0
                    },
                }],
                yAxis: [{
                    // minInterval: 200,
                    axisLabel: {
                        formatter: '{value}',
                        color: '#666666',
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#eef3f8'
                        }
                    },
                    splitLine: {
                        lineStyle: {
                            color: '#eef3f8'
                        }
                    }
                }],
                series: [{
                    type: 'bar',
                    data: vaules,
                    barWidth: '10px',
                    itemStyle: {
                        normal: {
                            color: '#78aef9',
                            barBorderRadius: [30, 30, 30, 30],
                        }
                    },
                    label: {
                        normal: {
                            show: false,
                        }
                    }
                }]
            };
            var newCahrt = echarts.init(el)
            newCahrt.setOption(option)
            $(window).resize(function () {
                newCahrt.resize()
            })
        }

        var dom1 = document.getElementById('ryqyqsCharts')

        $.ajax({
            cache: true,
            contentType: "application/json",
            dataType: "json",
            type: "POST",
            url: "/statistics/overview/left/trend",
            async: false,
            error: function (request) {
                $.modal.alertError("系统错误");
            },
            success: function (data) {
                ryqyqsChartsInit(dom1, data)
            }
        });

        layui.use('carousel', function(){
            var carousel = layui.carousel;
            //建造实例
            carousel.render({
                elem: '#test',
                width: '100%',
                height: '100%',
                arrow: 'always',
                indicator: 'none'//始终显示箭头
                //,anim: 'updown' //切换动画方式
            });
        });
        // 地图
        var thisMap = null

        var points;

        $.ajax({
            cache: true,
            contentType: "application/json",
            dataType: "json",
            type: "GET",
            url: "/statistics/overview/latitude/longitude",
            async: false,
            error: function (request) {
                $.modal.alertError("系统错误");
            },
            success: function (data) {
                points = data;
            }
        });

        /**
         * 地图初始化
         */
        function initMap() {
            var point = [120.04731, 28.88851];
            thisMap = new AMap.Map("mapContainer", {
                resizeEnable: true, // 是否监控地图容器尺寸变化
                zoom: 15, // 初始化地图层级
                dragEnable: true, // 地图是否可通过鼠标拖拽平移，默认为true
                keyboardEnable: true, // 地图是否可通过键盘控制，默认为true
                doubleClickZoom: true, // 地图是否可通过双击鼠标放大地图，默认为true
                center: point, // 中心点坐标
            });
            drawBounds();
            addMakers(points)
        }

        /**
         * 加行政区划
         */
        function drawBounds() {
            var district = null;
            var polygons = [];
            // 加载行政区划插件
            if (!district) {
                // 实例化DistrictSearch
                var opts = {
                    subdistrict: 0, // 获取边界不需要返回下级行政区
                    extensions: "all", // 返回行政区边界坐标组等具体信息
                    level: "district" // 查询行政级别为 市
                };
                district = new AMap.DistrictSearch(opts);
            }
            // 行政区查询
            district.search("永康市", function (status, result) {
                thisMap.remove(polygons); // 清除上次结果
                polygons = [];
                var bounds = result.districtList[0].boundaries;
                if (bounds) {
                    for (var i = 0, l = bounds.length; i < l; i++) {
                        // 生成行政区划polygon
                        var polygon = new AMap.Polygon({
                            strokeWeight: 2,
                            strokeStyle: "dashed",
                            path: bounds[i],
                            fillOpacity: 0.6,
                            fillColor: "#d7e2f4",
                            strokeColor: "#6395fc"
                        });
                        polygons.push(polygon);
                    }
                }
                thisMap.add(polygons);
                thisMap.setFitView(polygons, true, [20, 20, 20, 20], 12); // 视口自适应
            });
        }

        /**
         * 加标记点
         */
        function addMakers(pointsList) {
            var cluster = null;
            var markers = [];
            for (var i = 0; i < pointsList.length; i++) {
                markers.push(addMaker(pointsList[i]));
            }
            thisMap.add(markers);
        }


        /**
         * 添加单个点
         * @param data 数据源
         * @return {AMap.Marker}
         */
        function addMaker(data) {
            var marker = new AMap.Marker({
                position: new AMap.LngLat(parseFloat(data.lon), parseFloat(data.lat)),
                offset: new AMap.Pixel(-13, -39),
                title: data.NAME,
                content: `<div class="J106_mapIcon"><svg t="1587710885868" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1861" width="200" height="200"><path d="M466.596226 983.426415C373.856604 884.890566 207.698113 650.143396 160.362264 551.607547c-27.049057-57.962264-29.94717-72.45283-29.94717-160.362264 0-85.011321 2.898113-103.366038 26.083019-152.633962C193.207547 161.328302 269.524528 84.045283 346.807547 45.403774c58.928302-28.981132 69.554717-30.913208 165.192453-30.913208 88.875472 0 108.196226 2.898113 154.566038 25.116981 174.85283 82.113208 269.524528 280.150943 218.324528 456.935849-28.015094 94.671698-327.486792 515.864151-369.026415 516.830189-10.626415 0.966038-32.845283-13.524528-49.267925-29.94717z m119.78868-471.426415c59.89434-35.743396 82.113208-129.449057 45.403773-191.275472-21.25283-36.709434-79.215094-69.554717-119.788679-69.554717-50.233962 0-111.09434 40.573585-129.449057 86.943397-19.320755 49.267925-19.320755 62.792453 3.864151 113.026415 33.811321 75.350943 129.449057 104.332075 199.969812 60.860377z" p-id="1862" fill="${data.color}"></path></svg></div>`
            });

            marker.projectName = data.NAME;
            marker.projectId = data.id;

            marker.on('click', function (e) {
                var url = "/statistics/eachpark/dimension/" + e.target.projectId;
                //$.modal.openTab("园区总览二维", url);
                parent.openTab(url);

            });
            return marker;
        }

        initMap();

        var isFullScreen = false
        document.querySelector('.fullscreen').addEventListener('click', function(){
            if (isFullScreen) {
                document.exitFullscreen()
            } else {
                document.documentElement.requestFullscreen()
            }
            isFullScreen = !isFullScreen
        })

    })

    $('.J106_up_right').click(function(){
        $('.hide, .show').toggle()
        $('.Z106_item, .Z106_total, .Z106_xwyOuter').toggle()
    })

    // $('.fullscreen').click(function() {
    //     if (isFullScreen) {
    //         document.exitFullscreen()
    //     } else {
    //         document.documentElement.requestFullscreen()
    //     }
    //     isFullScreen = !isFullScreen
    // })


</script>
</body>
</html>
